{% extends "admin/change_list.html" %}
{% load static %}
{% block extrapagestyle %}
    <script>
      var CODEX = {
        CSRF_TOKEN: "{{ csrf_token }}",
        ADMIN_QUEUE_JOB_PATH: "{% url 'api:v3:admin:librarian_task' %}"
      };
      Object.freeze(CODEX);
    </script>
    <script defer src="{% static "admin/js/queue-job.js" type="text/javascript"%}"></script>
    <link href="{% static "admin/css/queue-job.css" %}"
          rel="stylesheet"
          type="text/css"/>
{% endblock extrapagestyle %}
{% block content_title %}
    <h1>Queue Librarian Jobs</h1>
{% endblock content_title %}
{% block content %}
    <form id="queueJobForm">
        <table class="queueJobs">
            <tr>
                <th colspan="3">Database</th>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="poll" id="poll" />
                </td>
                <td>Poll All Libraries For Changes</td>
                <td>Update the library if changes are detected.</td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="poll_force" id="poll_force" />
                </td>
                <td>Update All Comics</td>
                <td>
                    Forcibly update all the comics in all libraries, overwrite the database
                    and regenerate covers.
                </td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="cleanup_fks" />
                </td>
                <td>Clean Up Unused Foreign Keys</td>
                <td>
                    After deleting comics, unused linked objects remain in case new comics
                    use them. Runs daily.
                </td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="watchdog_sync" />
                </td>
                <td>Sync Watchdog with Database</td>
                <td>
                    Ensure the Watchdog file watcher is enabled per database preferences for
                    each library.
                </td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="db_vacuum" />
                </td>
                <td>Compact Database</td>
                <td>Run the sqlite3 vacuum pragma. Runs nightly.</td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="db_backup" />
                </td>
                <td>Backup Database</td>
                <td>Runs nightly.</td>
            </tr>
            <tr>
                <th colspan="3">Cover Thumbnails</th>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="create_missing_covers" />
                </td>
                <td>Create Missing Comic Covers</td>
                <td>only for comics that are missing them.</td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="purge_comic_covers" />
                </td>
                <td>Remove All Comic Covers</td>
                <td>in every library.</td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="cleanup_covers" />
                </td>
                <td>Cleanup Comic Covers</td>
                <td>from comics that no longer exist. Runs nightly.</td>
            </tr>
            <tr>
                <th colspan="3">Search Index</th>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="update_index" />
                </td>
                <td>Update Search Index</td>
                <td>with recently changed comics.</td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="rebuild_index" />
                </td>
                <td>Rebuild Search Index</td>
                <td>Delete and rebuild the search index from scratch.</td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="clean_queries" />
                </td>
                <td>Clean Up Search Cache</td>
                <td>Remove old cached search queries. Runs nightly.</td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="db_search_sync" />
                </td>
                <td>
                    Check Search Index / Database Match
                </td>
                <td>
                    Check to see if this database matches the current search index. If there
                    is a mismatch, rebuild the search index. Runs on startup.
                </td>
            </tr>
            <tr>
                <th colspan="3">
                    Codex Server
                </th>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="codex_update" />
                </td>
                <td>
                    Check for Codex Software Update
                </td>
                <td>
                    Force an update of the Codex software. If Codex updates to a new
                    version, it will restart.
                </td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="codex_restart" />
                </td>
                <td>
                    Restart Codex Server
                </td>
                <td>
                    Immediately.
                </td>
            </tr>
            <tr>
                <th colspan="3">
                    Notifications
                </th>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="notify_all" />
                </td>
                <td>
                    Library Changed
                </td>
                <td>
                    Signal all clients that the library has changed and the browser should
                    fetch new data.
                </td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="task" value="librarian_clear_status" />
                </td>
                <td>
                    Clear Librarian Statuses
                </td>
                <td>
                    Mark all Librarian tasks finished and notify browsers to fetch new data.
                </td>
            </tr>
        </table>
        <button id="queueJobButton" type="button" disabled>
            Queue
        </button>
    </form>
{% endblock content %}
